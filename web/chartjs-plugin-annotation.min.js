/*!
 * chartjs-plugin-annotation v2.0.0
 * https://www.chartjs.org
 * (c) 2022 chartjs-plugin-annotation Contributors
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chart.js"),require("chart.js/helpers")):"function"==typeof define&&define.amd?define(["chart.js","chart.js/helpers"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).ChartAnnotation=e(t.Chart,t.Chart.helpers)}(this,(function(t,e){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=n(t);const i={id:"annotation",version:"2.0.0",afterRegister(){this.annotationObserver=new MutationObserver((t=>{const e={};t.forEach((t=>{if(!t.target){return}const n=t.target.id;n&&!e[n]&&(e[n]=!0,this.handleAnnotationOptions(this.chart.options.plugins.annotation))})),this.updateAnnotations()})),this.annotationObserver.observe(document,{attributes:!0,subtree:!0})},afterUnregister(){this.annotationObserver&&this.annotationObserver.disconnect()},beforeInit(t){this.chart=t,this.handlers={},this.annotations=[],this.boxes=[]},beforeUpdate(t,e,n){const o=this.chart.options.plugins.annotation;if(this._config===o)return!1;this._config=o,this.handleAnnotationOptions(n),this._lastUpdate=Date.now();const i=this.chart.options.animation;return i.annotations===t.annotations||(t.annotations=i.annotations=!!e&&i),!0},handleAnnotationOptions(t){this.annotations.forEach((t=>{t.dispose&&t.dispose()})),this.annotations=[];for(const e of Object.values(t)){const t=e.drawTime||"afterDatasetsDraw",n=this.handlers[t]=this.handlers[t]||[],o=e.type||"line",i=this.createAnnotation(o,e);i&&(n.push(i),this.annotations.push(i))}},createAnnotation(t,n){const o=this.annotationTypes[t];return o?(n.chart=this.chart,new o(n)):null},addBox(t){this.boxes.push(t)},removeBox(t){this.boxes=this.boxes.filter((e=>t!==e))},updateAnnotations(){const t=Date.now()-this._lastUpdate<60;this.chart.options.animation.annotations=t,this.chart.update("none")},getMatchingElements(t,n,o){return o||(o={}),e.getMatchingVisibleElements(this.chart,t,n,o.intersect,o)},_resolveAnimations(t,n,o){const i=this.chart,a=i.options.animation,r=a&&a.animations,s=a&&a.animations[t];return e.resolveAnimations(n,o,s,r)},annotationTypes:{}};function a(t,n){const o=n.scales[t];return o?o:t.charAt(0)==="x"?n.scales.x:n.scales.y}function r(t,n){return e.callback(t,n)}function s(t,n){t.beginPath(),e.drawRoundedRectangle(t,n.x,n.y,n.w,n.h,n.radius),t.closePath()}function l(t,n){return{x1:Math.min(t.x,n.x),y1:Math.min(t.y,n.y),x2:Math.max(t.x,n.x),y2:Math.max(t.y,n.y)}}function d(t,e){if(e){const n=t.width/2;t.x+=e.width-n,t.width=n}}function h(t,e){if(e){const n=t.width/2;t.x-=n,t.width=n}}function u(t,e,n){const o=function(t,e,n){const o=Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2)),i=Math.min(o,e)/o;return{x:t.x+(n.x-t.x)*i,y:t.y+(n.y-t.y)*i}}(t,e,n);return{width:o.x-t.x,height:o.y-t.y}}const c="bottom",f="center",x="chartArea",y="left",p="middle",g="right",v="start",b="top";function m(t){const n=t.options.font;return n.string=`${n.size} ${n.family}`,n.size=e.toFont(n).lineHeight,n}function w(t,n,o,i){const{x:a,width:r,height:s}=function(t,n,o,i){const{x:a,y:r}=t,{width:s,height:l}=t,{textAlign:d,verticalAlign:h,xAdjust:u,yAdjust:c}=n,f=o/2,x=i/2,y=a;let p,g;return"left"===d?p=y:"right"===d?p=y+s:p=y+s/2,p+=u,"top"===h?g=r:"bottom"===h?g=r+l:g=r+l/2,g+=c,"left"===d?p+=f:"right"===d&&(p-=f),"top"===h?g+=x:"bottom"===h&&(g-=x),{x:p,width:s,height:l}}(t,n,o,i);e.renderText(n.ctx,n.content,a,n.y,n.font,{color:n.color,maxWidth:r,rotation:n.rotation,textAlign:n.textAlign,textBaseline:p})}const M={font:{family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null,lineWidth:void 0,strokeStyle:void 0},padding:4,color:"black",textAlign:"center",textBaseline:"middle",rotation:0,textStrokeColor:"",textStrokeWidth:0};class k{constructor(t){this.chart=t.chart,this.options=t,this.init(t)}init(t){let n=this.options;if(this.chart.options.plugins.annotation.common){const t=this.chart.options.plugins.annotation.common;n={...t,...n}}const{enabled:o,font:i,color:a,padding:r,textAlign:s,textStrokeColor:l,textStrokeWidth:d}=n;if(!o)return;const h=m({options:n});this.font=h,this.color=a,this.textAlign=s,this.content=r?this.options.content:null,this.textStrokeColor=l,this.textStrokeWidth=d,this.padding=r}resolveElementProperties(t,n){return{x:0,y:0,width:t.width,height:t.height}}draw(t){!this.options.enabled||!this.content||(t=t||this.options.display);const n=this.chart.chartArea;t!==x&&t!==this.options.display||this.drawLabel({x:n.left,y:n.top,width:n.right-n.left,height:n.bottom-n.top})}drawLabel(t){const n=this.chart.ctx,o=this.font,i=this.padding;n.save();const{x:a,y:s,width:l,height:d}=this.resolveElementProperties(t,{properties:{}});if(n.beginPath(),n.rect(a,s,l,d),n.closePath(),n.setLineDash&&n.setLineDash([]),n.globalCompositeOperation="source-over",n.fillStyle="black",n.strokeStyle="black",o){this.x=a+i,this.y=s+i+o.size/2,this.width=l-2*i,this.height=d-2*i;const t=e.toFont(o);n.font=t.string,n.textAlign=this.textAlign,w(this,this,0,0)}n.restore()}}function A(t,n){const o=n.chartArea,i=t.padding||0,a=t.width||0,r=t.height||0,s=t.position||"center";let l=o.left+(o.right-o.left)/2,d=o.top+(o.bottom-o.top)/2,h=0,u=0;if(s===b)l-=a/2,d=o.top+i,h=a,u=r;else if(s===c)l-=a/2,d=o.bottom-r-i,h=a,u=r;else if(s===y)l=o.left+i,d-=r/2,h=a,u=r;else if(s===g)l=o.right-a-i,d-=r/2,h=a,u=r;else if("start"===s)l=o.left+i,d=o.top+i,h=a,u=r;else if("end"===s)l=o.right-a-i,d=o.bottom-r-i,h=a,u=r;return{x:l,y:d,width:h,height:u}}class S extends k{constructor(t){super(t)}resolveElementProperties(t,n){return A(this.options,this.chart)}}const C={id:"labelAnnotation",beforeRegister(){o.default.register({id:"annotationLabel",datasetController:{id:"annotationLabel",dataElementType:"label"},elements:{},start:0,stop:1,beforeRegister(t){t.elements.label=class extends t.Element{constructor(t){super(),this.options=void 0,this.x=void 0,this.y=void 0,this.fallbackWidth=void 0,this.fallbackHeight=void 0,this.width=void 0,this.height=void 0,this.label=void 0,this.initWidget(t)}initWidget(t){Object.assign(this,t),this.options=t.options}inRange(t,e,n){return!1}getCenterPoint(t){return{x:this.x,y:this.y}}tooltipPosition(){return{x:this.x,y:this.y}}draw(t,e){}getProps(t,e){return e.reduce(((e,n)=>(e[n]=this[n],e)),{})}}})}},defaults:{adjustScaleRange:!0,animations:{numbers:{type:"number",properties:["x","y","width","height"]}}},beforeInit(t){t.labelAnnotations=[]},afterDatasetUpdate(t,e,n){const o=t.labelAnnotations,i=n.mode;let a=!1;"reset"===i&&(o.length=0);const{elements:r=[]}=e.meta;for(let t=0;t<r.length;t++)if("label"===r[t].type){const e=r[t];o.includes(e)||(o.push(e),a=!0)}return a}};class z{constructor(t){this.options=t,this.chart=t.chart,this._init()}isInAxis(t,e){const{axis:n,chart:o}=this.options,i=o.scales[n];return e>=i.top&&e<=i.bottom&&t>=i.left&&t<=i.right}_init(){const{axis:t}=this.options,{chart:e}=this,n=e.scales[t];if(!n)throw new Error(`No scale found with id '${t}'`);this.scale=n}getLinePos(t,e,n,o,i){const a=this.scale,{top:r,bottom:s,left:l,right:d,width:h,height:u}=a,c=a.isHorizontal();let f,x,y,p;return c?(y=l,p=d,f=x=a.getPixelForValue(e)):(y=r,p=s,x=a.getPixelForValue(e),f=x),{x:f,y:x,startX:y,startY:y,endX:p,endY:p,width:h,height:u}}getPoints(t){const e=this.scale.axis,{x:n,y:o,startX:i,startY:a,endX:r,endY:s}=t;return"x"===e?[{x:i,y:o},{x:r,y:o}]:[{x:n,y:a},{x:n,y:s}]}updateProps(t,e){const{x:n,y:o,startX:i,startY:a,endX:r,endY:s,width:l,height:d}=e;Object.assign(t,{x:n,y:o,startX:i,startY:a,endX:r,endY:s,width:l,height:d})}draw(t,e,n){const o=t.ctx,{x:i,y:a,startX:r,startY:s,endX:l,endY:d}=e,{borderColor:h="black",borderWidth:u=1,borderDash:c=[],borderDashOffset:f=0,drawTime:x="afterDatasetsDraw"}=n;o.save(),o.beginPath(),o.strokeStyle=h,o.lineWidth=u,o.setLineDash(c),o.lineDashOffset=f,o.moveTo(r,s),o.lineTo(l,d),o.stroke(),o.restore()}}const P={id:"lineAnnotation",afterRegister(){this.lineAnnotations={}},afterUnregister(){this.lineAnnotations={}},beforeUpdate(t,e,n){this.lineAnnotations={}},afterDatasetsDraw(t,e,n){this.lineAnnotations.afterDatasetsDraw=this.lineAnnotations.afterDatasetsDraw||{},this._drawLines(t,e,n,"afterDatasetsDraw")},afterDraw(t,e,n){this.lineAnnotations.afterDraw=this.lineAnnotations.afterDraw||{},this._drawLines(t,e,n,"afterDraw")},beforeDatasetsDraw(t,e,n){this.lineAnnotations.beforeDatasetsDraw=this.lineAnnotations.beforeDatasetsDraw||{},this._drawLines(t,e,n,"beforeDatasetsDraw")},beforeDraw(t,e,n){this.lineAnnotations.beforeDraw=this.lineAnnotations.beforeDraw||{},this._drawLines(t,e,n,"beforeDraw")},_drawLines(t,n,o,i){o=o||{};const{drawTime:a=i}=o;if(!["beforeDraw","afterDraw","beforeDatasetsDraw","afterDatasetsDraw"].includes(a))return;const r=this.lineAnnotations[a]=this.lineAnnotations[a]||{},s=t.scales,l=Object.keys(s).filter((t=>"x"===s[t].axis||"y"===s[t].axis&&!r[t]));for(let n=0;n<l.length;n++){const o=l[n],i=s[o];if(!e.defined(i))continue;const a=new z({axis:o,chart:t});r[o]=a;const d=e.valueOrDefault(i.options.min,i.min);this._drawLine(t,a,i,d,t.ctx,{})}},_drawLine(t,n,o,i,a,r){const s=n.getLinePos(0,i,0,0,r);n.draw(t,s,r)}};const D={id:"labelBoxAnnotation",afterRegister(){o.default.register({id:"annotationLabelBox",datasetController:{id:"annotationLabelBox",dataElementType:"labelBox"},elements:{},start:0,stop:1,beforeRegister(t){t.elements.labelBox=class extends t.Element{constructor(t){super(),this.options=void 0,this.initWidget(t)}initWidget(t){Object.assign(this,t),this.options=t.options}inRange(t,e,n){return!1}getCenterPoint(t){return{x:this.x,y:this.y}}tooltipPosition(){return{x:this.x,y:this.y}}draw(t,e){}getProps(t,e){return e.reduce(((e,n)=>(e[n]=this[n],e)),{})}}})}},beforeInit(t){t.labelBoxAnnotations=[]},afterDatasetUpdate(t,e,n){const o=t.labelBoxAnnotations,i=n.mode;let a=!1;"reset"===i&&(o.length=0);const{elements:r=[]}=e.meta;for(let t=0;t<r.length;t++)if("labelBox"===r[t].type){const e=r[t];o.includes(e)||(o.push(e),a=!0)}return a}};i.annotationTypes.line=class{constructor(t){this.layer=!1,this.visible=!0,this.id=t.id,this.type=t.type,this.options=t,this.elements=[],this.chart=t.chart;const n=t.annotations||t.config||{},o=n.callbacks||{};for(const t of Object.keys(o))this.options.callbacks=this.options.callbacks||{},t in o&&(this.options.callbacks[t]=n.callbacks[t]);this._init()}_init(){}isInAxis(t,e){return!0}isInLabel(t,e,n){const{x:o,y:i,width:a,height:r}=n;return t>=o&&t<=o+a&&e>=i&&e<=i+r}resolveElementProperties(t,n){const{chartArea:o}=this.chart;let i,a;const{xScaleID:r,yScaleID:s}=this.options,l=a(r,this.chart),d=a(s,this.chart)??l,h=n.properties||{},{x:u,y:c}=h;if(e.defined(u)){i=this.getXScale().getPixelForValue(u)}else{i=o.width/2+o.left}if(e.defined(c)){a=this.getYScale().getPixelForValue(c)}else{a=o.height/2+o.top}return{x:i,y:a,x2:i,y2:a,width:0,height:0,centerX:i,centerY:a}}getScaleID(t,e){return t||`${e}default`}getXScale(){return this.chart.scales[this.getScaleID(this.options.xScaleID,"x")]}getYScale(){return this.chart.scales[this.getScaleID(this.options.yScaleID,"y")]}draw(t,e){const n=this.drawLabel(t);this.elements=[...n]}resolveLineProperties(t,e){const{x:n,y:o,x2:i,y2:a,centerX:r,centerY:s}=e,{xMin:l,yMin:d,xMax:h,yMax:u}=this.options;return{x:n,y:o,x2:i,y2:a,centerX:r,centerY:s}}drawLabel(t){const{content:e,backgroundColor:n,borderColor:o,borderRadius:i,borderWidth:a,callout:r,drawTime:s,font:d,color:h,height:u,padding:c,position:f,rotation:x,shadowBlur:y,shadowColor:p,textAlign:g,textStrokeColor:v,textStrokeWidth:b,width:M,xValue:k,yValue:A,x:S,y:C,xAdjust:z,yAdjust:P}=this.options,D=A(this.chart.ctx,e,0,0,d),I=this.resolveElementProperties(t,{properties:{x:S??k,y:C??A}}),E=D.width+2*c,j=D.height+2*c;let T;const L=I.centerX+(z||0),R=I.centerY+(P||0);switch(f){case"start":I.x=L,I.y=R,T={textAlign:"left",x:L+c,y:R+c/2+D.height/2},d(I,T);break;case b:I.x=L-E,I.y=R,T={textAlign:"right",x:L-c,y:R+c/2+D.height/2},h(I,T);break;case y:I.x=L,I.y=R,T={textAlign:"center",x:L,y:R+c/2+D.height/2},d(I,T);break;case g:I.x=L-E/2,I.y=R,T={textAlign:"center",x:L,y:R+c/2+D.height/2},d(I,T);break;case p:I.x=L-E/2,I.y=R-j,T={textAlign:"center",x:L,y:R-j+c/2+D.height/2},d(I,T);break;default:I.x=L-E/2,I.y=R-j/2,T={textAlign:"center",x:L,y:R+c/2},d(I,T)}return I.width=M??E,I.height=u??j,I.backdrop={left:I.x,top:I.y,right:I.x+I.width,bottom:I.y+I.height,borderRadius:i,backgroundColor:n,borderWidth:a,borderColor:o},I.label={content:e,backgroundColor:n,borderColor:o,borderRadius:i,borderWidth:a,callout:r,color:h,font:d,height:j,padding:c,position:f,rotation:x,shadowBlur:y,shadowColor:p,textAlign:g,textStrokeColor:v,textStrokeWidth:b,width:E,xValue:S??k,yValue:C??A,x:T.x,y:T.y},I.callout=this.getCalloutProps(I,r),this._drawLabel(I),I}getCalloutProps(t,e){const{position:n}=this.options,{x:o,y:i,backdrop:a,width:r,height:s}=t;let l="left",d=l,h=o+r/2,u=i+s/2;switch(n){case g:h=a.left,l="bottom",d="top";break;case y:h=a.right,l="bottom",d="top";break;case v:l="top",d="bottom";break;case b:l="bottom",d="top";break;default:l="top",d="bottom"}return{enabled:!!e.enabled,display:e.display??"auto",calloutPosition:l,start:{x:h,y:"top"===l?a.top:a.bottom},end:{x:h,y:i+("top"===l?-e.margin:e.margin)},width:e.width,color:e.color,borderWidth:e.borderWidth}}_drawLabel(t){const{x:n,y:o,backdrop:i,callout:a,label:r}=t,l=this.chart.ctx;l.save(),this._drawLabelBackground(l,i,r),l.textAlign=r.textAlign,l.textBaseline="middle",l.fillStyle=r.color,l.font=`${r.font.size}px ${r.font.family}`,this._drawCallout(l,a),l.translate(r.x,r.y),l.fillText(r.content,0,0),r.textStrokeColor&&r.textStrokeWidth&&(l.lineJoin="round",l.lineWidth=r.textStrokeWidth,l.miterLimit=2,l.strokeStyle=r.textStrokeColor??r.color,l.strokeText(r.content,0,0)),l.restore()}_drawLabelBackground(t,e,n){const{left:o,top:i,right:a,bottom:r,borderRadius:s,backgroundColor:l,borderWidth:d,borderColor:h}=e;t.beginPath(),t.roundRect(o,i,a-o,r-i,s),t.closePath(),t.fillStyle=l,t.fill(),d&&(t.strokeStyle=h,t.lineWidth=d,t.stroke())}_drawCallout(t,e){if(!e.enabled)return;const{start:n,end:o,width:i,color:a,borderWidth:r}=e;t.beginPath(),t.lineWidth=r,t.strokeStyle=a,t.moveTo(n.x,n.y),t.lineTo(o.x,o.y),t.stroke()}_updateLabel(t,e,n){const{content:o,callout:i,position:a,rotation:r,backgroundColor:s,borderColor:l,borderRadius:d,borderWidth:h,font:u,color:c,shadowBlur:f,shadowColor:x,textAlign:y,textStrokeColor:p,textStrokeWidth:g,xValue:v,yValue:b,xAdjust:m,yAdjust:w}=n,M=this._getLabelContent(o),A=this._getLabelDimensions(t,M,u),S=A.width,C=A.height,z=this._getLabelPosition(t,e,S,C,a,v,b,m,w),P=this._getLabelBackdrop(z,S,C,d),D=this._getLabelCallout(P,z,i,a);z.rotation=r,this._drawLabelBackground(t,P,z),t.textAlign=y,t.textBaseline="middle",t.fillStyle=c,t.font=`${u.size}px ${u.family}`,this._drawCallout(t,D),t.translate(z.x,z.y),t.fillText(M,0,0),p&&g&&(t.lineJoin="round",t.lineWidth=g,t.miterLimit=2,t.strokeStyle=p??c,t.strokeText(M,0,0))}setElements(){return[]}getNearestItems(t,n){return this.getElement(n)??[]}getElement(t){return this.elements.find((e=>this._isOnLabel(t,e)))?this:null}_isOnLabel(t,e){const{x:n,y:o,width:i,height:a}=e;return n-i/2<=t.x&&t.x<=n+i/2&&o-a/2<=t.y&&t.y<=o+a/2}};let I=i;o.default.plugins.register(i);o.default.plugins.register(C);o.default.plugins.register(P);o.default.plugins.register(D);return I}));
//# sourceMappingURL=chartjs-plugin-annotation.min.js.map 